<!DOCTYPE html>
<html lang="es"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Catálogo - NIA-Cali | Toma Pedidos</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="app.js" defer></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#dc2626",
                        "primary-hover": "#b91c1c",
                        "background-light": "#ffffff",
                        "surface": "#f9fafb",
                    },
                    fontFamily: {
                        "sans": ["Roboto", "sans-serif"],
                    },
                    borderRadius: {
                        "DEFAULT": "0.375rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        body {
            font-family: 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #ffffff;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .product-card-border {
            border-left: 3px solid transparent;
        }
        .product-card-border:active {
            border-left: 3px solid #dc2626;
            background-color: #fef2f2;
        }#mobile-menu:target {
            display: block;
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="text-slate-800 min-h-screen bg-white">
<header class="sticky top-0 z-40 bg-white border-b border-gray-100">
<div class="flex items-center p-4 justify-between max-w-md mx-auto">
<div class="flex items-center gap-3">
<a href="index.html" class="text-slate-800 flex items-center justify-center">
<span class="material-symbols-outlined text-2xl">chevron_left</span>
</a>
<h1 id="category-title" class="text-xl font-bold tracking-tight">Catálogo</h1>
</div>
<div class="flex items-center gap-2">
<input id="search-input" type="text" placeholder="Buscar..." class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent" style="display:none;"/>
<button id="search-btn" class="flex size-10 items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
<span class="material-symbols-outlined">search</span>
</button>
<a href="carrito.html" class="flex size-10 items-center justify-center rounded-full hover:bg-gray-100 transition-colors relative">
<span class="material-symbols-outlined">shopping_cart</span>
<span id="cart-badge" class="absolute top-1 right-1 bg-primary text-white text-[10px] size-4 rounded-full flex items-center justify-center font-bold" style="display:none;">0</span>
</a>
</div>
</div>
</header>
<div class="fixed inset-0 z-50 hidden" id="mobile-menu">
<a class="absolute inset-0 bg-black/40 backdrop-blur-sm" href="#"></a>
<div class="absolute top-0 right-0 w-64 h-full bg-white shadow-2xl flex flex-col">
<div class="p-6 border-b border-gray-100 flex justify-between items-center">
<span class="font-bold text-lg">Menú</span>
<a class="text-slate-400" href="#"><span class="material-symbols-outlined">close</span></a>
</div>
<nav class="flex-1 py-4">
<a class="flex items-center gap-4 px-6 py-4 hover:bg-slate-50 transition-colors" href="index.html">
<span class="material-symbols-outlined text-slate-400">home</span>
<span class="font-medium">Inicio</span>
</a>
<a class="flex items-center gap-4 px-6 py-4 hover:bg-slate-50 transition-colors" href="carrito.html">
<span class="material-symbols-outlined text-slate-400">shopping_cart</span>
<span class="font-medium">Carrito</span>
</a>
<a class="flex items-center gap-4 px-6 py-4 hover:bg-slate-50 transition-colors border-t border-gray-50 mt-2" href="admin.html">
<span class="material-symbols-outlined text-slate-400">settings</span>
<span class="font-medium">Configuración</span>
</a>
</nav>
<div class="p-6 border-t border-gray-100">
<p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">v1.2.0 - B2B APP</p>
</div>
</div>
</div>
<main class="max-w-md mx-auto pb-24">
<div class="flex gap-2 p-4 overflow-x-auto no-scrollbar">
<button class="flex h-9 shrink-0 items-center justify-center gap-x-1.5 rounded-full bg-slate-100 px-4 border border-transparent active:border-primary/30">
<span class="material-symbols-outlined text-[18px]">tune</span>
<p class="text-sm font-medium">Filtros</p>
</button>
<button class="flex h-9 shrink-0 items-center justify-center gap-x-1 rounded-full bg-slate-50 border border-slate-200 px-4">
<p class="text-sm font-medium">Marca</p>
<span class="material-symbols-outlined text-[18px]">expand_more</span>
</button>
<button class="flex h-9 shrink-0 items-center justify-center gap-x-1 rounded-full bg-slate-50 border border-slate-200 px-4">
<p class="text-sm font-medium">Precio</p>
<span class="material-symbols-outlined text-[18px]">expand_more</span>
</button>
</div>
<div class="px-4 py-2 flex justify-between items-center">
<p id="product-count" class="text-[11px] font-bold uppercase tracking-widest text-slate-400">0 PRODUCTOS ENCONTRADOS</p>
<span class="material-symbols-outlined text-slate-400 text-lg">grid_view</span>
</div>
<div id="products-list" class="flex flex-col">
<!-- Los productos se cargarán dinámicamente -->
</div>
</main>
<a href="carrito.html" id="cart-button" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-30 w-full max-w-md px-6 pointer-events-none" style="display:none;">
<button class="pointer-events-auto flex items-center justify-center gap-2 w-full h-14 bg-primary text-white rounded-xl shadow-xl shadow-primary/30 active:scale-95 transition-transform">
<span class="material-symbols-outlined">shopping_basket</span>
<span id="cart-button-text" class="font-bold">Revisar Pedido</span>
</button>
</a>

<script>
let currentCategory = null;
let allProducts = [];

async function loadCatalog() {
    try {
        const manager = await ensureInventoryManagerReady();
        
        // Obtener categoría de la URL
        const params = new URLSearchParams(window.location.search);
        currentCategory = params.get('category');
        
        // Actualizar título
        if (currentCategory) {
            const category = manager.getCategoryById(currentCategory);
            if (category) {
                document.getElementById('category-title').textContent = category.name;
            }
        }
        
        // Cargar productos
        if (currentCategory) {
            allProducts = manager.getProductsByCategory(currentCategory);
        } else {
            allProducts = manager.getProducts();
        }
        
        renderProducts(allProducts);
        updateCartBadge();
        updateCartButton();
    } catch (error) {
        console.error('❌ Error cargando catálogo:', error);
    }
}

function renderProducts(products) {
    const container = document.getElementById('products-list');
    const countEl = document.getElementById('product-count');
    
    countEl.textContent = `${products.length} PRODUCTOS ENCONTRADOS`;
    
    if (products.length === 0) {
        container.innerHTML = '<div class="text-center py-12 text-slate-400"><p>No se encontraron productos</p></div>';
        return;
    }
    
    container.innerHTML = products.map(product => {
        const inStock = product.estado === 'DISPONIBLE';
        return `
            <div class="flex gap-4 bg-white px-4 py-4 border-b border-slate-50 items-center product-card-border ${!inStock ? 'opacity-80' : ''}">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-24 shadow-sm border border-slate-100 relative ${!inStock ? 'grayscale' : ''}" 
                     style='background-image: url("${product.image}");'>
                    ${!inStock ? '<div class="absolute inset-0 bg-white/40 flex items-center justify-center"><span class="text-[10px] font-bold bg-white px-2 py-1 rounded shadow-sm border border-slate-100 text-slate-400 uppercase tracking-tight">AGOTADO</span></div>' : ''}
                </div>
                <div class="flex flex-1 flex-col justify-center">
                    <p class="text-[15px] font-medium ${inStock ? 'text-slate-900' : 'text-slate-400'} leading-tight mb-1">${product.name}</p>
                    <p class="${inStock ? 'text-emerald-600' : 'text-primary'} text-[10px] font-bold uppercase tracking-wider mb-2">
                        ${inStock ? '✅ DISPONIBLE' : '❌ AGOTADO'}
                    </p>
                    <div class="flex items-baseline gap-1">
                        <p class="${inStock ? 'text-primary' : 'text-slate-400'} font-bold text-lg leading-none">${inventoryManager.formatPrice(product.price)}</p>
                    </div>
                </div>
                <div class="shrink-0">
                    ${inStock ? 
                        `<button onclick="addToCart(${product.id})" class="flex size-10 items-center justify-center rounded-full bg-primary text-white shadow-md active:scale-90 transition-transform">
                            <span class="material-symbols-outlined">add</span>
                        </button>` :
                        `<button class="flex px-3 py-2 items-center justify-center rounded-full border border-primary text-primary text-[10px] font-bold uppercase tracking-tight active:bg-primary active:text-white transition-colors">
                            AVISARME
                        </button>`
                    }
                </div>
            </div>
        `;
    }).join('');
}

function addToCart(productId) {
    inventoryManager.addToCart(productId, 1);
    showNotification('Producto agregado al carrito');
    updateCartBadge();
    updateCartButton();
}

function updateCartButton() {
    const button = document.getElementById('cart-button');
    const text = document.getElementById('cart-button-text');
    const count = inventoryManager.getCartItemCount();
    
    if (count > 0) {
        button.style.display = 'block';
        text.textContent = `Revisar Pedido (${count})`;
    } else {
        button.style.display = 'none';
    }
}

// Búsqueda
document.getElementById('search-btn').addEventListener('click', function() {
    const searchInput = document.getElementById('search-input');
    if (searchInput.style.display === 'none') {
        searchInput.style.display = 'block';
        searchInput.focus();
    } else {
        searchInput.style.display = 'none';
        searchInput.value = '';
        renderProducts(allProducts);
    }
});

document.getElementById('search-input').addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase();
    if (query.trim() === '') {
        renderProducts(allProducts);
        return;
    }
    
    const filtered = allProducts.filter(p => 
        p.name.toLowerCase().includes(query) || 
        p.description.toLowerCase().includes(query)
    );
    
    if (filtered.length === 0) {
        const container = document.getElementById('products-list');
        container.innerHTML = `
            <div class="text-center py-16 px-4">
                <span class="material-symbols-outlined text-slate-300 text-6xl mb-4">search_off</span>
                <p class="text-slate-500 font-semibold mb-2">No se encontraron productos</p>
                <p class="text-slate-400 text-sm">Intenta con otro término de búsqueda</p>
            </div>
        `;
        document.getElementById('product-count').textContent = '0 PRODUCTOS ENCONTRADOS';
    } else {
        renderProducts(filtered);
    }
});

document.addEventListener('DOMContentLoaded', loadCatalog);
</script>

</body></html>